FROM frdel/agent-zero-run:hacking

# Metadata labels
LABEL maintainer="GuardianAngelWw"
LABEL version="1.0.0" 
LABEL description="Agent Zero Docker container optimized for Zeabur deployment"

# Set environment variables to disable resource-intensive features
# These are defined as separate variables for clarity and maintainability
ENV A0_DISABLE_WHISPER=true
ENV A0_DISABLE_SEARXNG=true
ENV A0_WHISPER_MODEL=""
ENV A0_SKIP_WHISPER_PRELOAD=true
ENV A0_PRELOAD_DISABLED=true

# Create configuration directory and add config to disable Whisper
# This ensures the application doesn't try to load the model even if environment
# variables are not properly handled
RUN mkdir -p /etc/agent-zero/config && \
    echo '{"whisper": {"enabled": false, "preload": false, "model": null}}' > /etc/agent-zero/config/audio.json

# Expose the correct port (Agent Zero runs on port 80 internally)
EXPOSE 80

# Set a more lenient healthcheck for Zeabur environment
HEALTHCHECK --interval=60s --timeout=30s --start-period=120s --retries=3 \
  CMD curl -f http://localhost/ || wget -q --spider http://localhost/ || exit 1

# Use the default entrypoint from the base image
# The environment variables are already set above
